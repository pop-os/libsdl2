From: Simon McVittie <smcv@debian.org>
Date: Wed, 11 Aug 2021 14:51:56 +0100
Subject: Revert "x11: Don't let XRRSetScreenSize fire a BadMatch error."

This reverts commit d0effadf68e9b7299fdade38f6bcef3d1a117a12.

Bug: https://github.com/libsdl-org/SDL/issues/4630
Forwarded: https://github.com/libsdl-org/SDL/pull/4631
---
 src/video/x11/SDL_x11modes.c | 19 -------------------
 1 file changed, 19 deletions(-)

diff --git a/src/video/x11/SDL_x11modes.c b/src/video/x11/SDL_x11modes.c
index 7dab9ff..09707a5 100644
--- a/src/video/x11/SDL_x11modes.c
+++ b/src/video/x11/SDL_x11modes.c
@@ -995,15 +995,6 @@ X11_GetDisplayModes(_THIS, SDL_VideoDisplay * sdl_display)
     }
 }
 
-/* This catches an error from XRRSetScreenSize, as a workaround for now. */
-/* !!! FIXME: remove this later when we have a better solution. */
-static int (*PreXRRSetScreenSizeErrorHandler)(Display *, XErrorEvent *) = NULL;
-static int
-SDL_XRRSetScreenSizeErrHandler(Display *d, XErrorEvent *e)
-{
-    return (e->error_code == BadMatch) ? 0 : PreXRRSetScreenSizeErrorHandler(d, e);
-}
-
 int
 X11_SetDisplayMode(_THIS, SDL_VideoDisplay * sdl_display, SDL_DisplayMode * mode)
 {
@@ -1049,17 +1040,7 @@ X11_SetDisplayMode(_THIS, SDL_VideoDisplay * sdl_display, SDL_DisplayMode * mode
 
         mm_width = mode->w * DisplayWidthMM(display, data->screen) / DisplayWidth(display, data->screen);
         mm_height = mode->h * DisplayHeightMM(display, data->screen) / DisplayHeight(display, data->screen);
-
-        /* !!! FIXME: this can get into a problem scenario when a window is
-           bigger than a physical monitor in a configuration where one screen
-           spans multiple physical monitors. A detailed reproduction case is
-           discussed at https://github.com/libsdl-org/SDL/issues/4561 ...
-           for now we cheat and just catch the X11 error and carry on, which
-           is likely to cause subtle issues but is better than outright
-           crashing */
-        PreXRRSetScreenSizeErrorHandler = X11_XSetErrorHandler(SDL_XRRSetScreenSizeErrHandler);
         X11_XRRSetScreenSize(display, RootWindow(display, data->screen), mode->w, mode->h, mm_width, mm_height);
-        X11_XSetErrorHandler(PreXRRSetScreenSizeErrorHandler);
 
         status = X11_XRRSetCrtcConfig (display, res, output_info->crtc, CurrentTime,
           crtc->x, crtc->y, modedata->xrandr_mode, crtc->rotation,
